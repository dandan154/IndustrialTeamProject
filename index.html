<html>
    <head>
        <title>wrld.time.js Demo</title>    
        <script src="https://cdn-webgl.wrld3d.com/wrldjs/dist/latest/wrld.js"></script>
        <script src="wrld.time.js"></script>
        <script src="heatmap.js"></script>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.2.0/leaflet.css" />
        <link rel="stylesheet" href="wrld.time.css" />
        
        <!--EasyButton CDN Files-->
        <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.3.1/css/all.css" integrity="sha384-mzrmE5qonljUremFsqc01SB46JvROS7bZs3IO2EmfFsd15uHvIt+Y8vEf7N7fWAU" crossorigin="anonymous">
        <link href="https://cdnjs.cloudflare.com/ajax/libs/Leaflet.EasyButton/2.3.0/easy-button.css" rel="stylesheet">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/Leaflet.EasyButton/2.3.0/easy-button.js"></script>
        
    </head>
    <body style="margin: 0">
        <div id="map" style="height: 80%; width: 80%"></div>
        
        <script>
            var map = L.Wrld.map("map", "21343d1ce0a398a7244c29e3c619ea37", { 
                center: [ 56.462, -2.9707 ]
            });

            var pins = [];
            var pin  = L.marker([ 56.462, -2.9707 ], { time: "2018-09-01 09:00:00" });
            var pin = L.marker([ 56.463, -2.9708 ], { time: "2018-09-01 10:00:00" });

            for (var i = 0; i < 10; i++) {
                pins.push(L.marker(
                                [ 56.462 + Math.random(), -2.9707 + Math.random() ], 
                                { time: "2018-09-01 " + (10+i) + ":00:00" } ));
            }

            var layerGroup = L.layerGroup(pins);

            var time = L.control.timeSlider({ layer: layerGroup });
            
            var heatmapPoints = [];
	        for (var i = 0; i < 100; i++) {
		        heatmapPoints.push([56.462+Math.random()*.1-0.05, -2.9707+Math.random()*.1-0.05, 80])
	        }
	
	        var heat = L.heatLayer(heatmapPoints, {radius: 25});


            //Variables for button
            var prevHeading = 0;
            var prevTilt = 0;
            var newHeading = 0;
            var newTilt = 0;
            var animateCamera = true;
            
            var menu = [
                L.easyButton(
                    '<i class="fas fa-paint-brush"></i>',
                    function(){
                        //TODO edit heatmaps colours
                    },
                    'Change the colours of the heatmap'
                ),
                L.easyButton(
                    '<i class="fas fa-glasses"></i>',
                    function(){
                        //TODO edit heatmaps opacity
                    },
                    'Change the Opacity of the heatmap'
                )
            ];
            
            var zoombuttons = L.control.zoom({
             position:'topright'
            }).addTo(map);



            /** var zoom = [
                L.easyButton(
                    '<i class="fas fa-plus"></i>',
                    function(){
                        //TODO make a zoom in function
                    },
                    'Zoom In'        
                ),
                L.easyButton(
                    '<i class="fas fa-minus"></i>',
                    function(){
                        //TODO make a zoom out function
                    },
                    'Zoom Out'
                )
            ];
            L.easyBar(zoom).addTo(map); //TODO sort out positioning of this element
            */
            /**
             * This is the on/off switch for the heatmap
             */
             
            var toggle = L.easyButton({
                position: 'topleft',
                states: [{
                  stateName: 'turn-on',
                  icon: '<i class="fas fa-toggle-off"></i>',
                  title: 'Turn On Heatmap',
                  
                  /**
                   * This controls what happens when the button is clicked
                   */
                  onClick: function(control) {
                    prevHeading = map.getCameraHeadingDegrees();
                    prevTilt = map.getCameraTiltDegrees();
                    console.log(animateCamera);
                    map.setView(map.getCenter(), map.getZoom(), {
                        headingDegrees: newHeading, 
                        tiltDegrees: newTilt, 
                        animate: animateCamera
                    });
                    map.addControl(time);
                    L.easyBar(menu).addTo(map);
                    heat.addTo(map);
                    control.state('turn-off'); //This is the stateName this button changes to
                  }
                }, {
                  icon: '<i class="fas fa-toggle-on"></i>',
                  stateName: 'turn-off',
                  title: 'Turn Off Heatmap',
                  
                  /**
                   * This controls what happens when the button is clicked
                   */
                  onClick: function(control) {
                    map.setView(map.getCenter(), map.getZoom(), {
                        headingDegrees: prevHeading, 
                        tiltDegrees: prevTilt, 
                        animate: animateCamera
                    });
                    L.easyBar(menu).remove(map);
                    time.remove(map);
                    heat.remove(map);
                    control.state('turn-on'); //This is the stateName this button changes to
                  }
                }]
            });
            toggle.addTo(map);
          
            
            
        </script>
        <br>

        

    </body>
</html>